{% extends 'umt_youth_union/base.html' %}
{% block title %}Qu·∫£n l√Ω Nh√¢n s·ª±{% endblock %}

{% block content %}
<style>
    /* CSS cho c√°c Badge ch·ª©c v·ª• m·ªõi */
    .badge-role { padding: 5px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; text-transform: uppercase; display: inline-block; width: 110px; text-align: center; }
    
    .role-truong { background: #b71c1c; color: white; border: 1px solid #b71c1c; } /* ƒê·ªè ƒë·∫≠m */
    .role-pho-truong { background: #e57373; color: white; border: 1px solid #e57373; } /* ƒê·ªè nh·∫°t */
    
    .role-khoa { background: #003366; color: white; border: 1px solid #003366; } /* Xanh ƒë·∫≠m */
    .role-pho-khoa { background: #42a5f5; color: white; border: 1px solid #42a5f5; } /* Xanh nh·∫°t */
    
    .role-uy-vien { background: #27ae60; color: white; border: 1px solid #27ae60; } /* Xanh l√° */
    .role-doan-vien { background: #eee; color: #555; border: 1px solid #ccc; } /* X√°m */

    .manager-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .btn-excel { background: #217346; color: white; text-decoration: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 13px; display: flex; align-items: center; gap: 5px; }
    .btn-excel:hover { background: #1e6b41; }
    
    /* Select ƒë·∫πp h∆°n */
    .select-role { padding: 5px; border-radius: 4px; border: 1px solid #ddd; font-size: 12px; }
</style>

<div class="card" style="padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">
    
    <div class="manager-header">
        <h3 style="margin: 0; color: #003366;"><i class="fas fa-users-cog"></i> DANH S√ÅCH & B·ªî NHI·ªÜM</h3>
        
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'export_excel_nhan_su' %}" class="btn-excel"><i class="fas fa-file-excel"></i> Xu·∫•t Excel</a>
            
            <form method="get">
                <select name="chi_doan_id" onchange="this.form.submit()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="">üìÇ T·∫•t c·∫£ Chi ƒëo√†n</option>
                    {% for cd in danh_sach_chi_doan %}
                    <option value="{{ cd.id }}" {% if request.GET.chi_doan_id == cd.id|stringformat:"s" %}selected{% endif %}>
                        {{ cd.ten_chi_doan }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>

    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f8f9fa; color: #555; text-align: left; font-size: 13px;">
                <th style="padding: 12px; border-bottom: 2px solid #eee;">MSSV</th>
                <th style="padding: 12px; border-bottom: 2px solid #eee;">H·ªç t√™n</th>
                <th style="padding: 12px; border-bottom: 2px solid #eee;">Chi ƒêo√†n</th>
                <th style="padding: 12px; border-bottom: 2px solid #eee; text-align: center;">Ch·ª©c v·ª• hi·ªán t·∫°i</th>
                <th style="padding: 12px; border-bottom: 2px solid #eee;">Thao t√°c B·ªï nhi·ªám</th>
            </tr>
        </thead>
        <tbody>
            {% for sv in danh_sach_sv %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px; font-weight: bold;">{{ sv.ma_sinh_vien }}</td>
                <td style="padding: 12px;">{{ sv.ho_ten }}</td>
                <td style="padding: 12px;">
                    {% if sv.chi_doan_gan_ket %}{{ sv.chi_doan_gan_ket.ten_chi_doan }}{% else %}<span style="color:#999; font-style:italic;">Ch∆∞a c·∫≠p nh·∫≠t</span>{% endif %}
                </td>
                
                <td style="padding: 12px; text-align: center;">
                    {% if sv.chuc_vu == 'BI_THU_TRUONG' %} <span class="badge-role role-truong">B√≠ th∆∞ Tr∆∞·ªùng</span>
                    {% elif sv.chuc_vu == 'PHO_BI_THU_TRUONG' %} <span class="badge-role role-pho-truong">Ph√≥ BT Tr∆∞·ªùng</span>
                    {% elif sv.chuc_vu == 'BI_THU_KHOA' %} <span class="badge-role role-khoa">B√≠ th∆∞ Khoa</span>
                    {% elif sv.chuc_vu == 'PHO_BI_THU_KHOA' %} <span class="badge-role role-pho-khoa">Ph√≥ BT Khoa</span>
                    {% elif sv.chuc_vu == 'UY_VIEN' %} <span class="badge-role role-uy-vien">·ª¶y vi√™n BCH</span>
                    {% else %} <span class="badge-role role-doan-vien">ƒêo√†n vi√™n</span>
                    {% endif %}
                </td>

                <td style="padding: 12px;">
                    <form method="post" action="{% url 'bo_nhiem_can_bo' sv.id %}">
                        {% csrf_token %}
                        <div style="display: flex; gap: 5px;">
                            <select name="chuc_vu_moi" class="select-role">
                                <option value="DOAN_VIEN" {% if sv.chuc_vu == 'DOAN_VIEN' %}selected{% endif %}>ƒêo√†n vi√™n</option>
                                <option value="UY_VIEN" {% if sv.chuc_vu == 'UY_VIEN' %}selected{% endif %}>·ª¶y vi√™n BCH</option>
                                
                                <optgroup label="--- C·∫•p Khoa ---">
                                    <option value="BI_THU_KHOA" {% if sv.chuc_vu == 'BI_THU_KHOA' %}selected{% endif %}>B√≠ th∆∞ Khoa</option>
                                    <option value="PHO_BI_THU_KHOA" {% if sv.chuc_vu == 'PHO_BI_THU_KHOA' %}selected{% endif %}>Ph√≥ B√≠ th∆∞ Khoa</option>
                                </optgroup>
                                
                                <optgroup label="--- C·∫•p Tr∆∞·ªùng ---">
                                    <option value="BI_THU_TRUONG" {% if sv.chuc_vu == 'BI_THU_TRUONG' %}selected{% endif %}>B√≠ th∆∞ Tr∆∞·ªùng</option>
                                    <option value="PHO_BI_THU_TRUONG" {% if sv.chuc_vu == 'PHO_BI_THU_TRUONG' %}selected{% endif %}>Ph√≥ B√≠ th∆∞ Tr∆∞·ªùng</option>
                                </optgroup>
                            </select>
                            
                            <button type="submit" style="background: #003366; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" style="text-align: center; padding: 20px;">Kh√¥ng t√¨m th·∫•y sinh vi√™n n√†o.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}